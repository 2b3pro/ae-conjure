<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AE Conjure</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="theme-dark">
    <div class="panel">

        <!-- Toolbar -->
        <div class="toolbar">
            <span class="toolbar-title">AE Conjure</span>
            <div class="toolbar-spacer"></div>
            <div class="toggle-row tooltip" data-tooltip="Send comp structure to AI for context-aware scripts">
                <input type="checkbox" id="comp-context-toggle" checked>
                <label for="comp-context-toggle">Comp</label>
            </div>
            <button class="btn-icon tooltip" id="library-btn" data-tooltip="Saved scripts library">&#128218;</button>
            <button class="btn-icon tooltip" id="settings-btn" data-tooltip="API keys and settings">&#9881;</button>
        </div>

        <!-- Model selection row -->
        <div class="model-row">
            <select id="provider-select" class="tooltip" data-tooltip="AI provider (set API key in settings)"></select>
            <select id="model-select" class="tooltip" data-tooltip="Model to use for code generation"></select>
        </div>

        <!-- Chat area -->
        <div class="chat-container" id="chat-container">
            <!-- Messages render here -->
        </div>

        <!-- Prompt hints -->
        <div class="input-hints" id="input-hints"></div>

        <!-- Input area -->
        <div class="input-area">
            <button class="btn-icon tooltip" id="template-btn" data-tooltip="Browse prompt templates">&#9776;</button>
            <textarea id="prompt-input"
                      placeholder="Describe what you want to do in After Effects..."
                      rows="2"></textarea>
            <button class="btn-icon tooltip" id="refine-btn" data-tooltip="AI rewrites your prompt to be clearer and more specific">&#10024;</button>
            <button class="btn btn-primary tooltip" id="run-btn" data-tooltip="Generate and run script in After Effects">Run</button>
        </div>

        <!-- Template popover -->
        <div class="template-popover" id="template-popover">
            <!-- Templates render here via JS -->
        </div>
    </div>

    <!-- ============================================
         Settings Overlay
         ============================================ -->
    <div class="overlay" id="settings-overlay">
        <div class="overlay-header">
            <h2>Settings</h2>
            <button class="btn-icon" id="settings-close" title="Close">&#10005;</button>
        </div>
        <div class="overlay-body">

            <div class="settings-group">
                <h3>API Keys</h3>
                <div class="settings-field">
                    <label for="key-anthropic">Anthropic (Claude)</label>
                    <input type="password" id="key-anthropic" placeholder="sk-ant-...">
                </div>
                <div class="settings-field">
                    <label for="key-openai">OpenAI (GPT)</label>
                    <input type="password" id="key-openai" placeholder="sk-...">
                </div>
                <div class="settings-field">
                    <label for="key-google">Google (Gemini)</label>
                    <input type="password" id="key-google" placeholder="AIza...">
                </div>
            </div>

            <div class="settings-group">
                <h3>Behavior</h3>
                <div class="settings-field">
                    <label for="max-retries">Max Auto-Retries</label>
                    <input type="number" id="max-retries" min="1" max="10" value="3">
                </div>
            </div>

        </div>
        <div class="overlay-footer">
            <button class="btn" id="settings-close-btn" onclick="document.getElementById('settings-overlay').classList.remove('visible')">Cancel</button>
            <button class="btn btn-primary" id="settings-save">Save</button>
        </div>
    </div>

    <!-- ============================================
         Library Overlay
         ============================================ -->
    <div class="overlay" id="library-overlay">
        <div class="overlay-header">
            <h2>Script Library</h2>
            <button class="btn-icon" id="library-close" title="Close">&#10005;</button>
        </div>
        <div class="overlay-body">
            <div class="library-toolbar">
                <input type="text" id="library-search" placeholder="Search scripts...">
                <select id="library-filter">
                    <option value="all">All</option>
                    <option value="favorites">Favorites</option>
                    <option value="Animation">Animation</option>
                    <option value="Text">Text</option>
                    <option value="Shapes">Shapes</option>
                    <option value="Effects">Effects</option>
                    <option value="Camera">Camera</option>
                    <option value="Expressions">Expressions</option>
                    <option value="Utility">Utility</option>
                    <option value="Workflow">Workflow</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div id="library-list">
                <!-- Library items render here -->
            </div>
        </div>
    </div>

    <!-- Scripts (order matters) -->
    <script src="js/lib/CSInterface.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/ai-client.js"></script>
    <script src="js/retry-engine.js"></script>
    <script src="js/library.js"></script>
    <script src="js/templates.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
